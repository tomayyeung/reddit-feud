syntax = "proto3";

package devvit.plugin.builder;

import "devvit/plugin/buildpack/buildpack_common.proto";
import "devvit/runtime/bundle.proto";

option go_package = "github.snooguts.net/reddit/reddit-devplatform-monorepo/go-common/generated/protos/types/devvit/plugin/builder";

message BuildResponse {
  // Compiled bundles, differentiated by TargetRuntime
  repeated devvit.runtime.LinkedBundle bundles = 4;
  repeated devvit.plugin.buildpack.CompileLog errors = 2;
  repeated devvit.plugin.buildpack.CompileLog warnings = 3;

  reserved 1;
  reserved "bundle";
}

service Builder {
  // Compiles and links user code into an output bundle, including an audit trail, if desired.
  rpc Build(devvit.plugin.buildpack.CompileParams) returns (BuildResponse);

  // Automatically rebuild when input files change.
  rpc Watch(devvit.plugin.buildpack.CompileParams) returns (stream BuildResponse);
}
