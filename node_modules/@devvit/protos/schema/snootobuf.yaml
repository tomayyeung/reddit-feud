#
# This is the core snootobuf config.
# It drives the versions of external dependences, contains the go plugins, and proto checks.
# It's primarily executed by the gen-go-protos.sh script.
#

experimental:
  prototext_lock_file: true

checks:
  breaking_change:
    lock_branch: main
  
  linting:
    buf_raw_config:
      input_config:
        version: 'v1'
        lint:
          use:
            - BASIC
          ignore:
            - devvit/plugin/gl/methods.proto
            - .snootobuf
        breaking:
          ignore_unstable_packages: true

dependencies:
  - git: github.snooguts.net/reddit/data-api-firehose/protos@97f1e06
  
  - git: github.snooguts.net/reddit/devplatform-api/api/proto@bb120dd
# for local development
# - local_path: ../../../../../data-api-firehose/protos
# - local_path: ../../../../../devplatform-api/api/proto


plugins:
  - well_known_spec:
      name: SPEC_NAME_GO
    outputs:
      - from: github.snooguts.net/reddit/reddit-devplatform-monorepo
        into: ../../..
  
  - well_known_spec:
      name: SPEC_NAME_GO_GRPC
    outputs:
      - from: github.snooguts.net/reddit/reddit-devplatform-monorepo
        into: ../../..
  
  - go: github.com/bufbuild/connect-go/cmd/protoc-gen-connect-go@v1.7.0
    outputs:
      - from: github.snooguts.net/reddit/reddit-devplatform-monorepo
        into: ../../..
  
  - name: protoc-gen-devvit
    path: ../../../go-common/cmd/protoc-gen-devvit/run.sh
    options:
      - skip=devvit.actor.test
    outputs:
      - into: ../../../go-common/generated
