import { AppSettingsDefinition, GetFieldsResponse } from '@devvit/protos';
import { transformFormFields } from '../../apis/ui/helpers/transformForm.js';
import { Devvit } from '../Devvit.js';
import { extendDevvitPrototype } from './helpers/extendDevvitPrototype.js';
import { onValidateFormHelper } from './helpers/settingsUtils.js';
async function onGetSettingsFields() {
    if (!Devvit.appSettings) {
        throw new Error('App settings were not defined.');
    }
    return GetFieldsResponse.fromJSON({
        fields: {
            fields: transformFormFields(Devvit.appSettings),
        },
    });
}
async function onValidateForm(req, metadata) {
    return onValidateFormHelper(req, Devvit.appSettings, metadata);
}
export function registerAppSettings(config) {
    config.provides(AppSettingsDefinition);
    extendDevvitPrototype('GetAppSettingsFields', onGetSettingsFields);
    extendDevvitPrototype('ValidateAppForm', onValidateForm);
}
